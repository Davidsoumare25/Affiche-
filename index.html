<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PosterMarket</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* TON DESIGN QUE TU ADORES - NE PAS MODIFIER */
        body, html { margin:0; padding:0; font-family:sans-serif; height:100%; overflow:hidden; }
        :root{ --blue1:#0f172a; --blue2:#1e3a8a; --blue3:#2563eb; }
        body{
            background: linear-gradient(270deg, var(--blue1), var(--blue2), var(--blue3));
            background-size: 600% 600%;
            animation: gradientBG 15s ease infinite;
            display:flex; align-items:center; justify-content:center;
            height:100vh; font-size:18px; color:white;
        }
        @keyframes gradientBG { 0% {background-position:0% 50%;} 50% {background-position:100% 50%;} 100% {background-position:0% 50%;} }
        .card{
            background: rgba(255,255,255,0.95); padding:30px; border-radius:20px;
            width:90%; max-width:400px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            color: #1e3a8a;
        }
        .card h1 { margin-bottom:10px; font-style: italic; }
        button{ width:100%; padding:16px; border:none; border-radius:12px; margin-top:12px; font-size:18px; font-weight:600; cursor:pointer; transition: 0.3s; }
        .primary{ background:#2563eb; color:white; }
        .secondary{ background:#f1f5f9; color:#1e3a8a; }
        input{ width:100%; padding:14px; margin-top:12px; border-radius:12px; border:1px solid #ddd; font-size:16px; box-sizing: border-box; }
        .status { font-size: 12px; margin-top: 10px; font-weight: bold; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="loader" class="card">
        <p>Vérification de session...</p>
    </div>

    <div id="authView" class="card hidden">
        <h1>PosterMarket</h1>
        <p id="subTitle">Rejoignez la communauté</p>
        
        <div id="inputs">
            <input id="email" type="email" placeholder="Email">
            <input id="password" type="password" placeholder="Mot de passe">
        </div>

        <button class="primary" id="btnAction">Se connecter</button>
        <button class="secondary" id="btnToggle">Nouveau ? S'inscrire</button>
        
        <p id="statusMsg" class="status"></p>
    </div>

    <div id="appView" class="card hidden">
        <h1>Espace Vendeur</h1>
        <p>Bienvenue sur votre tableau de bord.</p>
        <button class="secondary" onclick="logout()">Se déconnecter</button>
    </div>

<script>
    // CONFIGURATION AVEC TES CLÉS RÉCUPÉRÉES
    const SB_URL = "https://lqevweyhxkvnckhtfpwh.supabase.co"; 
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxZXZ3ZXloeGt2bmNraHRmcHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNTk2NTIsImV4cCI6MjA4NTYzNTY1Mn0.F6EUcdco3mn8AxlR9CMzxCmcxL-5-BypAhSak0JQSWw";
    const _sb = supabase.createClient(SB_URL, SB_KEY);

    let isSignup = false;

    // ÉLÉMENTS DU DOM
    const authView = document.getElementById('authView');
    const appView = document.getElementById('appView');
    const loader = document.getElementById('loader');
    const statusMsg = document.getElementById('statusMsg');

    // 1. GESTION DE LA SESSION AUTOMATIQUE
    _sb.auth.onAuthStateChange((event, session) => {
        loader.classList.add('hidden');
        if (session) {
            authView.classList.add('hidden');
            appView.classList.remove('hidden');
        } else {
            authView.classList.remove('hidden');
            appView.classList.add('hidden');
        }
    });

    // 2. BASCULER ENTRE CONNEXION ET INSCRIPTION
    document.getElementById('btnToggle').onclick = () => {
        isSignup = !isSignup;
        document.getElementById('btnAction').innerText = isSignup ? "S'inscrire" : "Se connecter";
        document.getElementById('btnToggle').innerText = isSignup ? "Déjà membre ? Connexion" : "Nouveau ? S'inscrire";
        statusMsg.innerText = "";
    };

    // 3. ACTION PRINCIPALE (S'INSCRIRE OU SE CONNECTER)
    document.getElementById('btnAction').onclick = async () => {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        statusMsg.innerText = "Chargement...";

        if (isSignup) {
            const { error } = await _sb.auth.signUp({ email, password });
            if (error) statusMsg.innerText = "Erreur : " + error.message;
            else statusMsg.innerText = "Compte créé ! Vérifiez vos emails ou connectez-vous.";
        } else {
            const { error } = await _sb.auth.signInWithPassword({ email, password });
            if (error) statusMsg.innerText = "Erreur : Clé API ou Identifiants invalides.";
        }
    };

    // 4. DÉCONNEXION
    async function logout() {
        await _sb.auth.signOut();
    }
</script>

</body>
</html>
