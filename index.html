<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PosterMarket Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .page { display: none; }
        .page.active { display: block; }
        body { background: #f8fafc; font-family: sans-serif; }
    </style>
</head>
<body>

    <div id="loader" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-indigo-600 font-bold animate-bounce text-xl">PosterMarket...</div>
    </div>

    <div id="view-auth" class="page min-h-screen flex items-center justify-center p-6">
        <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-md border border-gray-100">
            <h1 class="text-3xl font-black text-indigo-600 mb-2 italic">PosterMarket</h1>
            <p id="auth-subtitle" class="text-gray-400 mb-6 text-sm">Crée ton catalogue de designer</p>
            
            <div class="space-y-4">
                <div id="signup-only" class="space-y-4">
                    <input type="text" id="reg-name" placeholder="Nom Complet" class="w-full p-4 bg-gray-50 rounded-2xl outline-none ring-1 ring-gray-200 focus:ring-2 focus:ring-indigo-500">
                    <input type="tel" id="reg-phone" placeholder="Numéro WhatsApp" class="w-full p-4 bg-gray-50 rounded-2xl outline-none ring-1 ring-gray-200 focus:ring-2 focus:ring-indigo-500">
                </div>
                <input type="email" id="reg-email" placeholder="Email" class="w-full p-4 bg-gray-50 rounded-2xl outline-none ring-1 ring-gray-200 focus:ring-2 focus:ring-indigo-500">
                <input type="password" id="reg-pass" placeholder="Mot de passe" class="w-full p-4 bg-gray-50 rounded-2xl outline-none ring-1 ring-gray-200 focus:ring-2 focus:ring-indigo-500">
                
                <button onclick="handleAuth()" id="btn-main" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg hover:bg-indigo-700 transition">Créer mon compte</button>
                <button onclick="toggleAuth()" id="btn-switch" class="w-full py-2 text-gray-400 text-sm font-bold">Déjà inscrit ? Se connecter</button>
            </div>
            <p id="status" class="text-red-500 text-xs mt-4 font-bold text-center uppercase"></p>
        </div>
    </div>

    <div id="view-app" class="page">
        <nav class="bg-white p-4 border-b flex justify-between items-center sticky top-0">
            <span class="font-black text-indigo-600 italic text-xl">PM</span>
            <button onclick="logout()" class="text-red-400 font-bold text-sm">Quitter</button>
        </nav>
        
        <div class="p-6 max-w-lg mx-auto text-center">
            <h2 class="text-2xl font-black mb-4">Espace Designer</h2>
            <div class="bg-indigo-50 p-6 rounded-3xl border-2 border-dashed border-indigo-200">
                <p class="text-indigo-600 font-bold mb-4">Ton catalogue est vide</p>
                <button class="px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold">+ Ajouter une affiche</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION (IMPORTANT : Vérifie ces clés dans Supabase !) ---
        const SB_URL = "https://gjinqdhodzlsjsjnnydl.supabase.co"; 
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdqaW5xZGhvZHpsc2pzam5ueWRsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3ODM2NjgsImV4cCI6MjA4NzM1OTY2OH0.7BH1cGi43_hX6FokAiTmH76tgKtqrgM8urCN_bNJurIzNTY1Mn0.F6EUcdco3mn8AxlR9CMzxCmcxL-5-BypAhSak0JQSWw";
        const _sb = supabase.createClient(SB_URL, SB_KEY);

        let isLoginMode = false;

        function showPage(id) {
            document.getElementById('loader').style.display = 'none';
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function toggleAuth() {
            isLoginMode = !isLoginMode;
            document.getElementById('signup-only').style.display = isLoginMode ? 'none' : 'block';
            document.getElementById('auth-subtitle').innerText = isLoginMode ? "Bon retour !" : "Crée ton catalogue de designer";
            document.getElementById('btn-main').innerText = isLoginMode ? "Se connecter" : "Créer mon compte";
            document.getElementById('btn-switch').innerText = isLoginMode ? "Nouveau ? Créer un compte" : "Déjà inscrit ? Se connecter";
        }

        async function handleAuth() {
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-pass').value;
            const status = document.getElementById('status');
            status.innerText = "Chargement...";

            if (isLoginMode) {
                const { error } = await _sb.auth.signInWithPassword({ email, password });
                if (error) status.innerText = "Erreur : " + error.message;
            } else {
                const { data, error } = await _sb.auth.signUp({ email, password });
                if (error) {
                    status.innerText = "Erreur : " + error.message;
                } else {
                    // Création du profil dans la table
                    await _sb.from('profiles').upsert({
                        id: data.user.id,
                        full_name: document.getElementById('reg-name').value,
                        phone: document.getElementById('reg-phone').value,
                        role: 'designer'
                    });
                    status.innerText = "Compte créé ! Connecte-toi.";
                    toggleAuth();
                }
            }
        }

        // --- GESTION DE LA SESSION AUTOMATIQUE ---
        _sb.auth.onAuthStateChange((event, session) => {
            if (session) {
                showPage('view-app');
            } else {
                showPage('view-auth');
            }
        });

        async function logout() {
            await _sb.auth.signOut();
            location.reload();
        }
    </script>
</body>
</html>

