<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>PosterMarket</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body, html {
  margin:0; padding:0; font-family:sans-serif; height:100%; overflow:hidden;
}
:root{
  --blue1:#0f172a; --blue2:#1e3a8a; --blue3:#2563eb;
}
body{
  background: linear-gradient(270deg, var(--blue1), var(--blue2), var(--blue3));
  background-size: 600% 600%;
  animation: gradientBG 15s ease infinite;
  display:flex; align-items:center; justify-content:center;
  height:100vh; font-size:18px; color:white;
}
@keyframes gradientBG {
  0% {background-position:0% 50%;}
  50% {background-position:100% 50%;}
  100% {background-position:0% 50%;}
}
.card{
  background: rgba(255,255,255,0.95); padding:30px; border-radius:20px;
  width:90%; max-width:400px; text-align:center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}
.card h1, .card h2{color: #1e3a8a; margin-bottom:10px;}
.card p{font-size:16px; margin-bottom:20px; opacity:0.8;}
button{width:100%; padding:16px; border:none; border-radius:12px; margin-top:12px; font-size:18px; font-weight:600; cursor:pointer;}
.primary{background:#1e3a8a;color:white;}
.secondary{background:transparent;color:#1e3a8a;border:2px solid #1e3a8a;}
select,input{width:100%; padding:14px; margin-top:12px; border-radius:12px; border:1px solid #ddd; font-size:16px;}
.hidden{display:none;}
</style>
</head>
<body>

<!-- LANDING -->
<div id="landing" class="card">
  <h1>PosterMarket</h1>
  <p>Marketplace pour designers et clients</p>
  <button class="primary" id="btnSignup">Créer un compte</button>
  <button class="secondary" id="btnLogin">Se connecter</button>
</div>

<!-- AUTH -->
<div id="authView" class="card hidden">
  <h2 id="authTitle"></h2>

  <select id="role">
    <option value="designer">Designer (je vends mes services)</option>
    <option value="client">Client (je commande une affiche)</option>
  </select>

  <input id="fullName" placeholder="Nom complet">
  <input id="phone" placeholder="Téléphone WhatsApp">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Mot de passe">

  <button id="btnSubmit">Continuer</button>
  <button onclick="backLanding()">Retour</button>
  <p id="status"></p>
</div>

<script>
const supabase = window.supabase.createClient(
  "https://lqevweyhxkvnckhtfpwh.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxZXZ3ZXloeGt2bmNraHRmcHdoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNTk2NTIsImV4cCI6MjA4NTYzNTY1Mn0.F6EUcdco3mn8AxlR9CMzxCmcxL-5-BypAhSak0JQSWw"
);

let currentUser=null;
let isSignup=true;

const landing=document.getElementById("landing");
const authView=document.getElementById("authView");
const authTitle=document.getElementById("authTitle");
const fullName=document.getElementById("fullName");
const phone=document.getElementById("phone");
const email=document.getElementById("email");
const password=document.getElementById("password");
const role=document.getElementById("role");
const status=document.getElementById("status");
const btnSubmit=document.getElementById("btnSubmit");

function show(v){ landing.classList.add("hidden"); authView.classList.add("hidden"); v.classList.remove("hidden"); }
function openAuth(signup){ isSignup=signup; authTitle.innerText=signup?"Créer un compte":"Connexion"; show(authView); }
function backLanding(){show(landing);}
function setStatus(m){status.innerText=m;}

// Boutons Landing
document.getElementById("btnSignup").onclick=()=>openAuth(true);
document.getElementById("btnLogin").onclick=()=>openAuth(false);

// Bouton soumission
btnSubmit.onclick=async()=>{
  const emailVal=email.value.trim();
  const passwordVal=password.value.trim();
  if(!emailVal || !passwordVal){ setStatus("Email et mot de passe requis"); return; }

  if(isSignup){
    const {data,error}=await supabase.auth.signUp({email:emailVal,password:passwordVal});
    if(error){ setStatus(error.message); return; }
    if(data.user){
      await supabase.from("profiles").insert({
        id:data.user.id,
        full_name:fullName.value,
        phone:phone.value,
        role:role.value
      });
    }
    setStatus("Compte créé ✔ Connecte-toi");
  }else{
    const {error}=await supabase.auth.signInWithPassword({email:emailVal,password:passwordVal});
    if(error){ setStatus(error.message); return; }
    setStatus("Connexion réussie ✔");
  }
};

// Session automatique
supabase.auth.getSession().then(({data})=>{ currentUser=data.session?.user??null; });
supabase.auth.onAuthStateChange((e,s)=>{ currentUser=s?.user??null; });
</script>

</body>
</html>
